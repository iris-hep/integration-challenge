CommonServices:
    systematicsHistogram: 'listOfSystematics'
    filterSystematics: "^(EG_|EL_|FT_|JET_|MET_).*$|^$"
    # onlySystematicsCategories:
    #   - jets
    #   - ftag
    #   - met
    #   - electrons
    #   - muons
    #   - event

PileupReweighting: {}

EventCleaning:
    runEventCleaning: True
    userGRLFiles:
      - 'GoodRunsLists/data22_13p6TeV/20250321/data22_13p6TeV.periodAllYear_DetStatus-v134-pro28-09_MERGED_PHYS_StandardGRL_All_Good_25ns.xml'


GeneratorLevelAnalysis: {}

Jets:
  - containerName: 'AnaJets'
    jetCollection: 'AntiKt4EMPFlowJets'
    runJvtUpdate: False
    runNNJvtUpdate: True
    runGhostMuonAssociation: True
    systematicsModelJES: 'Category'
    systematicsModelJER: 'Full'
    JVT: {} 
    PtEtaSelection:
        minPt: 15000.0
        maxEta: 2.8
    FlavourTagging:
      - btagger: 'DL1dv01'
        btagWP: 'FixedCutBEff_85'
        bTagCalibFile: '/cvmfs/atlas.cern.ch/repo/sw/database/GroupData/xAODBTaggingEfficiency/13TeV/2023-22-13TeV-MC20-CDI-2023-09-13_v1.root'
      - btagger: 'DL1dv01'
        btagWP: 'FixedCutBEff_77'
        bTagCalibFile: '/cvmfs/atlas.cern.ch/repo/sw/database/GroupData/xAODBTaggingEfficiency/13TeV/2023-22-13TeV-MC20-CDI-2023-09-13_v1.root'
      - btagger: 'DL1dv01'
        btagWP: 'FixedCutBEff_70'
        bTagCalibFile: '/cvmfs/atlas.cern.ch/repo/sw/database/GroupData/xAODBTaggingEfficiency/13TeV/2023-22-13TeV-MC20-CDI-2023-09-13_v1.root'
      - btagger: 'DL1dv01'
        btagWP: 'Continuous'
        bTagCalibFile: '/cvmfs/atlas.cern.ch/repo/sw/database/GroupData/xAODBTaggingEfficiency/13TeV/2023-22-13TeV-MC20-CDI-2023-09-13_v1.root'
    FlavourTaggingEventSF:
      - containerName: 'AnaJets.baselineJvt'
        btagger: 'DL1dv01'
        btagWP: 'Continuous'
        generator: 'default'  # https://topcptoolkit.docs.cern.ch/latest/settings/jets/#ftagjetsfblock
        # https://ftag.docs.cern.ch/recommendations/superseded/#dl1dv01-pcbt-september-2023
        bTagCalibFile: '/cvmfs/atlas.cern.ch/repo/sw/database/GroupData/xAODBTaggingEfficiency/13TeV/2023-22-13TeV-MC20-CDI-2023-09-13_v1.root'

Electrons:
  - containerName: 'AnaElectrons'
    crackVeto: True
    IFFClassification: {}
    WorkingPoint:
      - selectionName: 'loose'
        identificationWP: 'TightLH'
        isolationWP: 'NonIso'
        noEffSF: True
      - selectionName: 'tight'
        identificationWP: 'TightLH'
        isolationWP: 'Tight_VarRad'
        noEffSF: True
    PtEtaSelection:
        minPt: 15000.
        useClusterEta: True
        maxEta: 2.8

Muons:
  - containerName: 'AnaMuons'
    IFFClassification: {}
    WorkingPoint:
      - selectionName: 'loose'
        quality: 'Medium'
        isolation: 'NonIso'
        saveCombinedSF: True
      - selectionName: 'tight'
        quality: 'Medium'
        isolation: 'Tight_VarRad'
        saveCombinedSF: True
    PtEtaSelection:
        minPt: 15000.0
        maxEta: 2.8


MissingET:
  - containerName: 'AnaMET'
    # Format should follow Object: '<containerName>.<postfix>'
    jets: 'AnaJets'
    electrons: 'AnaElectrons.tight'
    muons: 'AnaMuons.tight'
    setMuonJetEMScale: False

# containerName and postfix must be defined in their respective blocks
OverlapRemoval:
  inputLabel: 'preselectOR'
  outputLabel: 'passesOR'
  # Format should follow Object: '<containerName>.<postfix>'
  jets: 'AnaJets.baselineJvt'
  electrons: 'AnaElectrons.tight'
  muons: 'AnaMuons.tight'

# ObjectCutFlow:
#   - containerName: 'AnaElectrons'
#     selectionName: 'tight'
#   - containerName: 'AnaJets'
#     selectionName: 'baselineJvt'

Thinning:
  - containerName: 'AnaJets'
    outputName: 'OutJets'
    selectionName: 'baselineJvt'
  - containerName: 'AnaElectrons'
    outputName: 'OutElectrons'
    selectionName: 'tight||loose'
  - containerName: 'AnaMuons'
    outputName: 'OutMuons'
    selectionName: 'tight||loose'

Trigger:
  triggerChainsPerYear:  # https://twiki.cern.ch/twiki/bin/viewauth/Atlas/LowestUnprescaled
    '2015':
      - 'HLT_e24_lhmedium_L1EM20VH || HLT_e60_lhmedium || HLT_e120_lhloose'
      #- 'HLT_mu20_iloose_L1MU15 || HLT_mu50' #Triggerchain not found trigger is unavailable, returns efficiency = 0
    '2016':
      - 'HLT_e26_lhtight_nod0_ivarloose || HLT_e60_lhmedium_nod0 || HLT_e140_lhloose_nod0'
      - 'HLT_mu26_ivarmedium || HLT_mu50'
    '2017':
      - 'HLT_e26_lhtight_nod0_ivarloose || HLT_e60_lhmedium_nod0 || HLT_e140_lhloose_nod0'
      - 'HLT_mu26_ivarmedium || HLT_mu50'
    '2018':
      - 'HLT_e26_lhtight_nod0_ivarloose || HLT_e60_lhmedium_nod0 || HLT_e140_lhloose_nod0'
      - 'HLT_mu26_ivarmedium || HLT_mu50'
    #Run3 recomendations: https://twiki.cern.ch/twiki/bin/view/Atlas/TrigEgammaRecommendationsRun3
    '2022':
      - 'HLT_e26_lhtight_ivarloose_L1EM22VHI || HLT_e60_lhmedium_L1EM22VHI || HLT_e140_lhloose_L1EM22VHI'
      - 'HLT_mu24_ivarmedium_L1MU14FCH || HLT_mu50_L1MU14FCH'

    '2023':
      - 'HLT_e26_lhtight_ivarloose_L1eEM26M || HLT_e60_lhmedium_L1eEM26M || HLT_e140_lhloose_L1eEM26M'
      - 'HLT_mu24_ivarmedium_L1MU14FCH || HLT_mu50_L1MU14FCH'

  
  noFilter: False
  postfix: '_emu'
  electrons: 'AnaElectrons.loose'
  electronID: 'Tight'
  electronIsol: 'Tight_VarRad'
  muons: 'AnaMuons.loose'
  muonID: 'Medium'



#Removing all cuts from TCT
#Cutflow to be made in Coffea
#EventSelection: #To do: re-check all selection cuts for ojbect definitions
#  - electrons: 'AnaElectrons.loose'
#    muons: 'AnaMuons.loose'
#    jets: 'AnaJets.baselineJvt'
#    met: 'AnaMET'
#    btagDecoration: 'ftag_select_DL1dv01_FixedCutBEff_77'
#    noFilter: False
#    cutFlowHistograms: True
#    selectionCutsDict:
#      'SUBcommon': |
#        GLOBALTRIGMATCH _emu
#        JET_N 25000 >= 2
#        JET_N_BTAG >= 1
#        SAVE
#      'fourjetoneb_el': |
#        IMPORT SUBcommon
#        EL_N 27000 >= 1
#        JET_N 25000 >= 4
#        SAVE
      #'fourjetoneb_mu': |
      #  IMPORT SUBcommon
      #  MU_N 27000 >= 1
      #  JET_N 25000 >= 4
      #  SAVE

# After configuring each container, many variables will be saved automatically.
Output:
  treeName: 'reco'
  vars: []
  metVars: []
  containers:
      # Format should follow: '<suffix>:<output container>'
      el_: 'OutElectrons'
      jet_: 'OutJets'
      met_: 'AnaMET'
      '': 'EventInfo'
      mu_: 'OutMuons'
  commands:
      # Turn output branches on and off with 'enable' and 'disable'
      - disable jet_jvtEfficiency.*
      - disable trigPassed_HLT.*

AddConfigBlocks: []
